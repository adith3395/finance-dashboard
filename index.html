<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pelacak Keuangan Otomatis</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background:#f5f5f4 }
.chart-container { height:320px }
@media print {
.no-print{display:none}
.chart-container{height:250px}
}
</style>
</head>

<body class="min-h-screen">

<header class="bg-stone-800 text-white p-4 flex justify-between items-center no-print">
<h1 class="font-bold text-lg">ğŸ’° Pelacak Keuangan</h1>
<div class="flex gap-2">
<select id="monthFilter" class="text-black p-1 rounded"></select>
<button onclick="toggleSettings()" class="bg-stone-600 px-3 py-1 rounded">âš™ï¸</button>
<button onclick="window.print()" class="bg-emerald-600 px-3 py-1 rounded">ğŸ–¨ï¸</button>
</div>
</header>

<div id="settingsPanel" class="hidden bg-white p-4 border-b no-print">
<div class="grid md:grid-cols-2 gap-4">
<div>
<label>ğŸ¯ Target Tabungan</label>
<input id="settingGoal" type="number" class="w-full border p-2">
</div>
<div>
<label>ğŸš§ Batas Budget</label>
<input id="settingBudget" type="number" class="w-full border p-2">
</div>
</div>
<button onclick="saveSettings()" class="mt-4 bg-stone-800 text-white px-4 py-2 rounded">Simpan</button>
</div>

<main class="p-4 space-y-6 max-w-7xl mx-auto">

<section class="grid md:grid-cols-3 gap-4">
<div class="bg-white p-4 rounded shadow">
<p>Total Pemasukan</p>
<h2 id="totalIncomeDisplay" class="text-2xl font-bold"></h2>
</div>
<div class="bg-white p-4 rounded shadow">
<p>Total Pengeluaran</p>
<h2 id="totalExpenseDisplay" class="text-2xl font-bold"></h2>
</div>
<div class="bg-white p-4 rounded shadow">
<p>Sisa Saldo</p>
<h2 id="balanceDisplay" class="text-2xl font-bold"></h2>
</div>
</section>

<section class="grid md:grid-cols-2 gap-6">
<div class="bg-white p-4 rounded shadow">
<h3 class="font-bold mb-2">Income vs Expense</h3>
<div class="chart-container"><canvas id="barChart"></canvas></div>
</div>
<div class="bg-white p-4 rounded shadow">
<h3 class="font-bold mb-2">Kategori Pengeluaran</h3>
<div class="chart-container"><canvas id="doughnutChart"></canvas></div>
</div>
</section>

<section class="grid md:grid-cols-3 gap-6">
<div class="bg-white p-4 rounded shadow no-print">
<h3 class="font-bold mb-2">â• Transaksi</h3>

<div class="flex gap-2 mb-2">
<button onclick="setTransactionType('income')" id="btnIncome" class="flex-1 border p-2">Pemasukan</button>
<button onclick="setTransactionType('expense')" id="btnExpense" class="flex-1 border p-2">Pengeluaran</button>
</div>

<input id="formDate" type="date" class="w-full border p-2 mb-2">
<input id="formDesc" placeholder="Deskripsi" class="w-full border p-2 mb-2">
<input id="formAmount" type="number" placeholder="Jumlah" class="w-full border p-2 mb-2">

<select id="formCategory" class="w-full border p-2 mb-2">
<option>Makanan</option><option>Transportasi</option><option>Gaji</option><option>Lainnya</option>
</select>

<button onclick="addTransaction()" class="bg-stone-800 text-white w-full py-2 rounded">Simpan</button>
</div>

<div class="md:col-span-2 bg-white rounded shadow">
<table class="w-full text-sm">
<thead class="bg-stone-100">
<tr><th>Tgl</th><th>Desc</th><th>Masuk</th><th>Keluar</th><th class="no-print">âŒ</th></tr>
</thead>
<tbody id="transactionTableBody"></tbody>
</table>
</div>
</section>

</main>

<script>
const STORAGE_KEY = 'keuanganAppState_v1';

const state = {
transactions: [],
settings: { goal:2000000, budgetLimit:3000000 },
currentMonth: new Date().toISOString().slice(0,7),
formType: 'expense'
};

let barChart, doughnutChart;

function saveState(){
localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function loadState(){
const saved = localStorage.getItem(STORAGE_KEY);
if(saved) Object.assign(state, JSON.parse(saved));
}

document.addEventListener('DOMContentLoaded',()=>{
loadState();
initMonthSelector();
setTransactionType(state.formType);
document.getElementById('formDate').valueAsDate = new Date();
updateUI();
});

function initMonthSelector(){
const months = [...new Set(state.transactions.map(t=>t.date.slice(0,7)))];
months.push(state.currentMonth);
const sel=document.getElementById('monthFilter');
sel.innerHTML='';
[...new Set(months)].sort().reverse().forEach(m=>{
const o=document.createElement('option');
o.value=m;
o.text=new Date(m+'-01').toLocaleDateString('id-ID',{month:'long',year:'numeric'});
sel.appendChild(o);
});
sel.value=state.currentMonth;
sel.onchange=e=>{state.currentMonth=e.target.value;saveState();updateUI();}
}

function calculate(){
let inc=0,exp=0,cats={};
state.transactions.filter(t=>t.date.startsWith(state.currentMonth))
.forEach(t=>{
if(t.type==='income')inc+=t.amount;
else{exp+=t.amount;cats[t.category]=(cats[t.category]||0)+t.amount;}
});
return {inc,exp,balance:inc-exp,cats};
}

function updateUI(){
const s=calculate();
totalIncomeDisplay.textContent=format(s.inc);
totalExpenseDisplay.textContent=format(s.exp);
balanceDisplay.textContent=format(s.balance);
renderTable();
renderCharts(s);
}

function renderTable(){
const tb=document.getElementById('transactionTableBody');
tb.innerHTML='';
state.transactions.filter(t=>t.date.startsWith(state.currentMonth))
.forEach(t=>{
tb.innerHTML+=`
<tr>
<td>${t.date}</td>
<td>${t.desc}</td>
<td>${t.type==='income'?format(t.amount):'-'}</td>
<td>${t.type==='expense'?format(t.amount):'-'}</td>
<td class="no-print"><button onclick="del(${t.id})">ğŸ—‘ï¸</button></td>
</tr>`;
});
}

function renderCharts(s){
if(!barChart){
barChart=new Chart(barChartCtx,{type:'bar',
data:{labels:['Masuk','Keluar'],datasets:[{data:[0,0]}]},
options:{responsive:true}});
}
barChart.data.datasets[0].data=[s.inc,s.exp];
barChart.update();

if(!doughnutChart){
doughnutChart=new Chart(doughnutCtx,{type:'doughnut',
data:{labels:[],datasets:[{data:[]}]}});
}
doughnutChart.data.labels=Object.keys(s.cats);
doughnutChart.data.datasets[0].data=Object.values(s.cats);
doughnutChart.update();
}

function addTransaction(){
state.transactions.push({
id:Date.now(),
date:formDate.value,
desc:formDesc.value,
amount:+formAmount.value,
category:formCategory.value,
type:state.formType
});
saveState();
initMonthSelector();
updateUI();
formDesc.value=formAmount.value='';
}

function del(id){
state.transactions=state.transactions.filter(t=>t.id!==id);
saveState();
updateUI();
}

function toggleSettings(){settingsPanel.classList.toggle('hidden')}
function saveSettings(){
state.settings.goal=+settingGoal.value;
state.settings.budgetLimit=+settingBudget.value;
saveState();toggleSettings();updateUI();
}

function setTransactionType(t){state.formType=t;saveState();}
function format(n){return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0}).format(n);}
</script>

</body>
</html>
